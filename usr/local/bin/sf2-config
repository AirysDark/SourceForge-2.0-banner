#!/usr/bin/env bash
set -euo pipefail
AUTO="/usr/local/bin/sf2-banner"
_sf2_reload(){ [ -x "$AUTO" ] && "$AUTO" >/dev/null 2>&1 || (command -v sf2-banner >/dev/null 2>&1 && sf2-banner >/dev/null 2>&1) || true; }
trap _sf2_reload EXIT INT TERM

DIR="/usr/lib/sf2/banner.d"
mkdir -p "$DIR"
echo "Plugins in: $DIR"
i=1
declare -A MAP
shopt -s nullglob
for f in "$DIR"/*.sh; do
  base="$(basename "$f")"
  [ -x "$f" ] && st="ENABLED" || st="disabled"
  printf " %2d) %-24s [%s]\n" "$i" "$base" "$st"
  MAP[$i]="$f"
  i=$((i+1))
done
echo
read -rp "Toggle which # (q=quit): " pick || true
[[ "${pick:-q}" =~ ^[0-9]+$ ]] || exit 0
target="${MAP[$pick]:-}"
[ -n "$target" ] || exit 0
if [ -x "$target" ]; then chmod -x "$target" && echo "Disabled $(basename "$target")"
else chmod +x "$target" && echo "Enabled  $(basename "$target")"; fi